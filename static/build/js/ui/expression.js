define(["jquery","path"],function(e,t){e.extend({unselectContents:function(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}}),e.fn.extend({selectContents:function(){e(this).each(function(e){var t,o,n,i,a=this;(n=a.ownerDocument)&&(i=n.defaultView)&&void 0!==i.getSelection&&void 0!==n.createRange&&(t=window.getSelection())&&void 0!==t.removeAllRanges?(o=n.createRange(),o.selectNode(a),0==e&&t.removeAllRanges(),t.addRange(o)):document.body&&void 0!==document.body.createTextRange&&(o=document.body.createTextRange())&&(o.moveToElementText(a),o.select())})},setCaret:function(){if(e.support.msie){var t=function(){e(this).get(0).caretPos=document.selection.createRange().duplicate()};e(this).click(t).select(t).keyup(t)}}});var o={replaceSmile:function(e){for(var o=["微笑","大笑","调皮","惊讶","耍酷","发火","害羞","汗水","大哭","自满","鄙视","困","夸奖","晕倒","疑问","媒婆","狂吐","青蛙","发愁","亲吻","挑衅","爱心","心碎","玫瑰","礼物","难过","奸笑","可爱","得意","呲牙","暴汗","楚楚可怜","睡觉","哭","生气","震惊","口水","彩虹","夜空","太阳","钱钱","灯泡","咖啡","蛋糕","音乐","爱","胜利","赞","踩","OK"],n=0;n<o.length;n++)e=e.replace(new RegExp("{:"+o[n]+":}","gm"),"[em_"+o[n]+"_"+(n+1)+"]"),e=e.replace(new RegExp("[[]"+o[n]+"]","gm"),"[em_"+o[n]+"_"+(n+1)+"]");return e=e.replace(/\[em_(.*?)_([0-9]*)\]/g,'<img src="'+t.imgPath+'/face/i_f_$2.gif" title="$1" border="0" style="float:none;margin:0;" />')},replaceForSmile:function(e){for(var o=["微笑","大笑","调皮","惊讶","耍酷","发火","害羞","汗水","大哭","自满","鄙视","困","夸奖","晕倒","疑问","媒婆","狂吐","青蛙","发愁","亲吻","挑衅","爱心","心碎","玫瑰","礼物","难过","奸笑","可爱","得意","呲牙","暴汗","楚楚可怜","睡觉","哭","生气","震惊","口水","彩虹","夜空","太阳","钱钱","灯泡","咖啡","蛋糕","音乐","爱","胜利","赞","踩","OK"],n=0;n<o.length;n++)e=e.replace(new RegExp('<img src="'+t.imgPath+"/face/i_f_"+(n+1)+'.gif" title="'+o[n]+'" border="0" style="float:none;margin:0;">',"gm"),"["+o[n]+"]");return e},showFace:function(n,i){var a=t.imgPath,c=["微笑","大笑","调皮","惊讶","耍酷","发火","害羞","汗水","大哭","自满","鄙视","困","夸奖","晕倒","疑问","媒婆","狂吐","青蛙","发愁","亲吻","挑衅","爱心","心碎","玫瑰","礼物","难过","奸笑","可爱","得意","呲牙","暴汗","楚楚可怜","睡觉","哭","生气","震惊","口水","彩虹","夜空","太阳","钱钱","灯泡","咖啡","蛋糕","音乐","爱","胜利","赞","踩","OK"];e(n).unbind().bind("mousedown",function(){var t;if(e("#facebox").length<=0){t=e("#sliderMask").length>0?'<div id="facebox" class="dodoFace left"><table border="0" cellspacing="1" cellpadding="0" bgcolor="#e5e5e5" style="margin:0;"><tr>':'<div id="facebox" class="dodoFace"><table border="0" cellspacing="1" cellpadding="0" bgcolor="#e5e5e5" style="margin:0;"><tr>';for(var n=1;n<=c.length;n++)"["+c[n-1]+"]",t+='<td bgcolor="#FFFFFF"><img title="'+c[n-1]+'" src="'+a+"/face/i_f_"+n+'.gif" /></td>',n%10==0&&(t+="</tr>");t+="</table></div>"}else e("#facebox").remove();e("body").append(t),e(".dodoFace img").bind({click:function(t){var n=e(".dodoFace img").index(e(this));c[n].length,e(this).parents(".message-guestPost").find(".TipstextCount label");e(i).setCaret();var a=e(i).get(0);console.log(a),o.insertAtCaret(a,"["+c[n]+"]"),e("#facebox").remove(),t.stopPropagation()}}),e(this).parent().find(".dodoFace").find("td").bind({mouseover:function(){e(this).attr("bgColor","#F0F0F0")},mouseout:function(){e(this).attr("bgColor","#FFFFFF")}});var l=e(this).position(),r=l.top+e(this).outerHeight();console.log(l.top),console.log(e(this).outerHeight()),e("#facebox").css({top:r,left:l.left}).show()})},insertAtCaret:function(e,t){if(console.log(e),document.all&&e.createTextRange&&e.caretPos){var o=e.caretPos;o.text=""==o.text.charAt(o.text.length-1)?t+"":t}else if(e.setSelectionRange){var n=e.selectionStart,i=e.selectionEnd,a=e.value.substring(0,n),c=e.value.substring(i);e.value=a+t+c,e.focus();var l=t.length;e.setSelectionRange(n+l,n+l),e.blur()}else e.value+=t,console.log(e)}};return o});